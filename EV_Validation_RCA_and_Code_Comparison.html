<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>EV Validation Change – Root Cause & Comparison</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 14px; color: #333; line-height: 1.6; }
    h1 { color: #1f4e79; }
    h2 { color: #1f4e79; border-bottom: 2px solid #ddd; padding-bottom: 4px; margin-top: 28px; }
    h3 { color: #2f5597; margin-top: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
    th { background-color: #f2f2f2; }
    .ok { color: green; font-weight: bold; }
    .error { color: #c00000; font-weight: bold; }
    .note { background-color: #f9f9f9; border-left: 4px solid #1f4e79; padding: 12px; margin-top: 12px; }
    .code { background-color: #f4f4f4; border: 1px solid #ccc; padding: 10px; font-family: Consolas, monospace; font-size: 13px; }
  </style>
</head>
<body>

<h1>EV Interval Validation – Root Cause Analysis & Code Change</h1>

<p>
This document explains why EV interval data appears to stop after meter changes,
what the system was previously doing, and how the updated validation logic fixes
the issue without masking real data quality problems.
</p>

<h2>Background</h2>

<p>
EV interval data is generated by EV charge boxes (channel 1000). When an EV charger
is installed or removed mid-billing cycle, interval data correctly starts or stops
based on the physical device lifecycle. Billing data (channel 1) is independent
and continues as long as the billing meter remains active.
</p>

<h2>Old Validation Logic (Previous Behavior)</h2>

<div class="code">
IF meterstop_dt &lt; billstop<br>
&nbsp;&nbsp;THEN raise INCOMPINTVS
</div>

<div class="note">
<strong>Problem:</strong><br>
This rule was applied to all meters, including EV meters. When an EV charger was
removed before the billing period ended, the system treated this as bad data and
removed the premise from EV studies.
</div>

<h2>New Validation Logic (Updated Behavior)</h2>

<div class="code">
IF meterstop_dt &lt; billstop:<br>
&nbsp;&nbsp;IF channel = 1000 AND metertype IN ('evmeter','uevmeter'):<br>
&nbsp;&nbsp;&nbsp;&nbsp;Skip INCOMPINTVS (expected EV behavior)<br>
&nbsp;&nbsp;ELSE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Raise INCOMPINTVS
</div>

<div class="note">
<strong>Result:</strong><br>
EV chargers can stop mid-cycle without being treated as data quality failures.
All other meters retain the original strict validation rules.
</div>

<h2>Example: EV Charger Retired Mid-Cycle (Premise 70591797)</h2>

<h3>EV Charge Box Lifecycle</h3>

<table>
  <tr>
    <th>Premise ID</th>
    <th>Charge Box ID</th>
    <th>Effective Start</th>
    <th>Effective End</th>
    <th>Status</th>
  </tr>
  <tr>
    <td>70591797</td>
    <td>0910042001280655453222623323</td>
    <td>2025-04-15 09:58</td>
    <td>2025-04-19 08:22</td>
    <td>Asset In-Service</td>
  </tr>
  <tr>
    <td>70591797</td>
    <td>0910042001280655453222623323</td>
    <td>2025-04-19 08:22</td>
    <td>9999-12-30</td>
    <td>Retired Asset</td>
  </tr>
</table>

<div class="note">
The EV charger was physically retired on April 19, 2025.
</div>

<h3>Interval & Billing Data Alignment</h3>

<table>
  <tr>
    <th>Study</th>
    <th>Channel</th>
    <th>Meter Stop Date</th>
    <th>Bill End Date</th>
    <th>Old Result</th>
    <th>New Result</th>
  </tr>
  <tr>
    <td>FPLC-RS1EV</td>
    <td>1000 (EV)</td>
    <td>2025-04-19</td>
    <td>2025-04-30</td>
    <td class="error">INCOMPINTVS</td>
    <td class="ok">Accepted</td>
  </tr>
  <tr>
    <td>FPLC-RSEV</td>
    <td>1 (Billing)</td>
    <td>9999-12-31</td>
    <td>2025-04-30</td>
    <td class="ok">OK</td>
    <td class="ok">OK</td>
  </tr>
</table>

<h2>What Changed – Summary</h2>

<ul>
  <li>EV interval data is no longer penalized for expected mid-cycle charger removal.</li>
  <li>Valid EV data up to the meter stop date is preserved.</li>
  <li>Billing data behavior is unchanged.</li>
  <li>Non-EV meters still follow strict completeness rules.</li>
</ul>

<h2>Conclusion</h2>

<p>
The updated validation logic aligns system behavior with the physical lifecycle of
EV chargers. EV interval data stops because the device is removed, not due to
ingestion or validation failure. This change prevents false data quality errors
while preserving all existing safeguards.
</p>

</body>
</html>
